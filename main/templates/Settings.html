{% load static %}

<!DOCTYPE html>
<html lang="en" dir="ltr">
    <meta charset="UTF-8">
    <title> Settings </title>
    <!-- Boxicons CDN Link -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,500' rel='stylesheet' type='text/css'>
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
     <link rel="stylesheet" href="{% static 'css/settings.css' %}">
   </head>
<body>
  <!----------Nav side bar-->
<div class="sidebar">
	<div class="logo-details">
	  <i class="bi bi-bar-chart-line-fill"></i>
	  <span class="logo_name">Stock Portfolio</span>
	</div>
  <ul class="nav-links">
    <li>
      <a href="{% url 'index' %}">
        <i class='bx bxs-home' ></i>
        <span class="links_name">Home</span>
      </a>
    </li>
    <li>
      <a href="{% url 'news' %}">
        <i class='bx bx-box' ></i>
        <span class="links_name">News</span>
      </a>
    </li>
    <li>
      <a href="{% url 'dashboard' %}">
        <i class='bx bx-list-ul' ></i>
        <span class="links_name">Dashboard</span>
      </a>
    </li>
    <li>
      <a href="{% url 'addportfolio' %}">
        <i class='bx bx-user-plus'></i>
        <span class="links_name">Add Portfolio</span>
      </a>
    </li>
    <li>
      <a href="{% url 'stock' %}">
        <i class='bx bx-coin-stack' ></i>
        <span class="links_name">Stock</span>
      </a>
    </li>
    <li>
      <a href="{% url 'mutualfunds' %}">
        <i class='bx bx-pie-chart-alt-2' ></i>
        <span class="links_name">Mutual Funds</span>
      </a>
    </li>
    <li>
      <a href="{% url 'watchlist' %}">
        <i class='bx bx-book-alt' ></i>
        <span class="links_name">Watch List</span>
      </a>
    </li>
    <li>
      <a href="{% url 'settings' %}">
        <i class='bx bx-cog' ></i>
        <span class="links_name">Setting</span>
      </a>
    </li>
    <li class="log_out">
      <a href="#">
        <i class='bx bx-log-out'></i>
        <span class="links_name">Log out</span>
      </a>
    </li>
  </ul>
</div>
{% csrf_token %}
<!----------hOME section-->
	  <section class ="home-section">
		<nav>
		  <div class="sidebar-button">
			<i class='bx bx-menu sidebarBtn'></i>
			<span class="dashboard">Settings</span>
		  </div>
      <div class="profile-details">
        <span class="admin_name">{{username}}</span>
      </div>
		</nav>
    <br>
    <br>
    <br>
    <section class="py-5 my-5">
      <div class="container">
        <div class="bg-white shadow rounded-lg d-block d-sm-flex">
          <div class="profile-tab-nav border-right">
            <div class="p-4">
              <h4 class="text-center">User</h4>
            </div>
            <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
              <a class="nav-link active" id="password-tab" data-toggle="pill" href="#password" role="tab" aria-controls="password" aria-selected="false">
                <i class="fa fa-key text-center mr-1"></i> 
                Password
              </a>
              <a class="nav-link" id="contact-tab" data-toggle="pill" href="#contact" role="tab" aria-controls="contact" aria-selected="false">
                <i class="fa fa-phone text-center mr-1"></i> 
                Contact Us
              </a>
            </div>
          </div>
          <div class="tab-content p-4 p-md-5" id="v-pills-tabContent">
            <div class="tab-pane fade show active" id="contact" role="tabpanel" aria-labelledby="contact-tab">
              <h3 class="mb-4">Contact Settings</h3>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                      <label>First Name</label>
                      <input type="text" id="fname" class="form-control" value="{{data.fname}}">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                      <label>Last Name</label>
                      <input type="text" id="lname" class="form-control" value="{{data.lname}}">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                      <label>Email</label>
                      <input type="text" id="email" class="form-control" value="{{data.email}}">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                      <label>Phone number</label>
                      <input type="text" id="phone" class="form-control" value="{{data.phoneno}}">
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="form-group">
                      <label>Bio</label>
                    <textarea class="form-control" value="{{data.bio}}" id="bio" rows="4">{{data.bio}}</textarea>
                  </div>
                </div>
              </div>
              <div>
                <span id="updateuser-error"></span>
              </div>
              <div>
                <button class="btn btn-primary" onclick="return updateuserdetails()">Update</button>
                <button class="btn btn-light">Cancel</button>
              </div>
            </div>
            <div class="tab-pane fade" id="password" role="tabpanel" aria-labelledby="password-tab">
              <h3 class="mb-4">Password Settings</h3>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                      <label>Old password</label>
                      <input type="password" id="old-pass" class="form-control">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                      <label>New password</label>
                      <input type="password" id="pass" class="form-control">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                      <label>Confirm new password</label>
                      <input type="password" id="conf-pass" class="form-control">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                  <span id="update-pass-error"></span>
                </div>
              </div>
              <div>
                <button class="btn btn-primary" onclick ="return updatePass()">Update</button>
                <button class="btn btn-light">Cancel</button>
              </div>
            </div>
          
            
          </div>
        </div>
      </div>
    </section>
  
    
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script>
    function updatePass(){

      var oldpass = document.getElementById("old-pass").value;
      var newpass = document.getElementById("pass").value;
      var confpass = document.getElementById("conf-pass").value;

      console.log(newpass)
      console.log(confpass)
      if (newpass != confpass || newpass == "" || confpass == ""){
        document.getElementById("update-pass-error").innerHTML = "New Password and Confirm should be same.";
        document.getElementById("update-pass-error").value = "New Password and Confirm should be same.";
        return false
      }

      csrfmiddlewaretoken = document.getElementsByName("csrfmiddlewaretoken")[0].value;
        $.ajax({
            type:"POST",
            url:'{% url 'updatepassord' %}',
            data:{
              'csrfmiddlewaretoken': csrfmiddlewaretoken,
              'oldpass':oldpass,
              'newpass':newpass,
            },
            success :function(data){
                if(data.success){
                  console.log(data.success);
                  document.getElementById("old-pass").value = "";
                  document.getElementById("pass").value = "";
                  document.getElementById("conf-pass").value = "";
                  document.getElementById("update-pass-error").innerHTML = "Password Updated";
                }else{
                  document.getElementById("update-pass-error").innerHTML = data.error;
                  console.log(data.error);
                }
            }
        })
        return false
    }

    function updateuserdetails(){
      var fname = document.getElementById("fname").value;
      var lname = document.getElementById("lname").value;
      var email = document.getElementById("email").value;
      var phone = document.getElementById("phone").value;
      var bio = document.getElementById("bio").value;

      csrfmiddlewaretoken = document.getElementsByName("csrfmiddlewaretoken")[0].value;
        $.ajax({
            type:"POST",
            url:'{% url 'updateuserdetails' %}',
            data:{
              'csrfmiddlewaretoken': csrfmiddlewaretoken,
              'fname':fname,
              'lname':lname,
              'email':email,
              'phone':phone,
              'bio':bio,
            },
            success :function(data){
                if(data.success){
                  console.log(data.success);
                  document.getElementById("updateuser-error").innerHTML = data.success;
                }else{
                  document.getElementById("updateuser-error").innerHTML = data.error;
                  console.log(data.error);
                }
            }
        })
        return false
    }
    
  </script>
  
  </body>
  </html>
